---
title: "galahr: a GUI to assist learning about high dimensions in R"
author: "Ursula Laa"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using the GUI}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

galahr provides a GUI to the `tourr` package based on `shiny` and `plotly`. Upload your dataset and use the input panel to select settings for the tour and display, move to the results panel to play the tour animation.

## Basic usage

Launch they GUI with the default dataset as

```{r launchApp, eval = FALSE}
launchApp()
```


This will build a Shiny app with some initial default settings, the parameters can then be modified via the graphical interface inside the app. Note that the GUI has two separate tabs, "input"" and "results"", and the "Update results"" action button must be pressed before the results are updated with new input selections. This is because some options may result in long running times before the results can be updated (in particular recording a guided tour).

To look at a different dataset you can either use the file upload in the "input" panel after launching the app, or pass your dataframe in the function call. For example you can launch using the `GW170817` data as

```{r launchApp, eval = FALSE}
launchApp(paramDF = GW170817)
```

## Examples

### `tsfeatureData` 
By default the `tsfeatureData` dataset is loaded when calling `launchApp()`. This data set contains features (calculated with the `tsfeatures` package) for three types of time series, the type is stored in the `category` variable. By default the app will start up with a grand tour shown in the density display, and up to six variables are selected. For a better overview of this dataset we use the `input` panel, in the second column we select the `groups` display type. In this dataset there is only one categorical variable which is preselected as the grouping variable. We then push the `update results` action button on the bottom of the first column to load the tour with the new input selections. We can now open the `results` tab to inspect the dataset with groups mapped to colour. Interestingly the set of music time series appears to be more similar to air temperature time series than bird songs in this feature space.

### `galah`
Another example dataset included with this package is `galah`. We can launch the app as `launchApp(galah)` to load it. Again the dataset contains exactly one categorical variable, but in this case the `col` variable lists hex codes which can directly be mapped to the corresponding color when selecting the `groups` display. This dataset is best viewed with a planned tour as shown in the example below.
 ```{r, eval = FALSE}
# matrix representation of planes to show in the planned tour
m1 <- spinebil::basisMatrix(1,2,6)
m2 <- spinebil::basisMatrix(3,4,6)
m3 <- spinebil::basisMatrix(5,6,6)
# store the planes in list format and save as .rds
galahPath <- list(m3, m1, m2, m3)
saveRDS(galahPath, file="galahPath.rds")
  )
  ```
We can now lauch the app with the `galah` dataset
 ```{r, eval = FALSE}
 launchApp(galah)
 ```
and open the `input` panel. Again we select the `groups` display option. In the first colum we select the tour type to be "Planned tour" and we upload the previously generated "galahPath.rds" file. We now update the results with the action button at the bottom at the first column and move to the `results` panel to see the planned tour of the `galah` dataset!

### `GW170817`

The third dataset included with the package is a posterior sample fitting neutron star parameters to the observed gravitational wave event GW170817.
FIXME paper reference to LIGO here?
We can load the dataset into the app with 
 ```{r, eval = FALSE}
 launchApp(GW170817)
 ```
Since this is a posterior sample the default display `density` is appropriate for this dataset and we can directly look at the grand tour loaded in the `results` panel. In this display we can now modify the transparancy of the datapoints by selecting alpha. For this example a value around 0.1 is appropriate to distinguish regions of high/low density in the display. We may notice strong association between the parameters m1 and m2. We can return to the `input` panel and change some settings. For example we can remove m2 from the list of parameters, and select the guided tour option. This enables us to select a projection pursuit index to optimise in the guided tour. If the package `mbgraphic` is installed, we can select the `splines2d` index and press "Update results". It will take about a minute to find the guided tour path. Once the optimisation is finished we can replay the guided tour in the results panel. In this case we find a strong functional dependence between multiple of the parameters in the dataset. With the final projection on display, we can come back to the `input` panel once more and select the "Local tour" option to explore the neighborhood of the optimised final projection (remember to press "Update results" before returning to the `results` panels). We could also change the display to "linked brushing" which will allow us to highlight based on the 1-d view in the last column of the `results` panel, or in the tour display.


## The `input` panel

FIXME show screenshot of input panel?

The following options are available:

- File upload options to load parameter values from a CSV format data file
- Checkbox selection of the parameter values that should be used as input to the tour (choose from all numeric parameters in the input data)
- Checkbox selection to turn rescaling on/off. If on the data will be rescaled such that each parameter takes values between 0 and 1.
- Tour type selection. By default a short grand tour path will be generated. The other available options are: guided tour, planned tour, little tour and local tour (starting from the current basis, this is particularly useful when stopping the tour display and loading a local tour to explore the surroundings of an identified interesting view).
- If the selected tour type is grand, little or local tour the user may select the number of planes to generate (note that all tour paths are first recorded and then replayed in the results panel).
- If the selected tour type is guided tour the user may select the index function to be used. The options depend on the availability of relevant packages. The `tourr` functions `holes` and `cmass` are always available. If the `binostics` package is installed the scagnostics indexes "Skinny", "Striated", "Convex" and "Clumpy" are available. If the `mbgraphic` package is installed the index functions "splines2d" and "dcor2d" are available, and if the `minerva` package is installed the index functions "MIC" and "TIC" are available. In addition, if grouping is selected "lda_pp" and "pda_pp" from the `tourr` package are also available.
- If the selected tour type is planned tour, the user is asked to upload the anchor planes in RDS format.
- The angular step size used in the interpolation between planes can be selected between 0.01 and 1, with the default value at 0.05.
- The update results button must be pressed to load the tour path with the selected settings.
- There are currently three different display options. All displays are in the form of 2-d scatter plots, with selection between density display (allowing the user to tune the transparancy), linked brushing (with highlighting based on selection in either the 2-d projection or along input parameter values) and grouped display (mapping a selected grouping variable to color)
- If the grouped display is selected, the user may select a grouping variable from all character type input parameters.

## The `results` panel

The first column in the output panel contains several options for the user to select:

- A play button allowing to start/pause the tour.
- A save button that will save the current projection (FORMAT?).
- A print button that will print the current projection to the console.
- A save all button that will save the complete current tour path (i.e. all anchor planes, FORMAT?)
- If the selected display type is "density"" the user can select the point transparancy by choosing alpha between 0.01 and 1.
- If the selected display type is "linked brushing" the user can select the checkbox "Show selected points only" to remove all other points from the display (e.g. for more efficient rendering).
- There is also the option to select a sample from the input data, which will be randomly selected. This may be required for large datasize if rendering becomes to slow for viewing the tour display.
- In case of the "linked brushing" display the user may select the update logic between "new only" (reset selection each time), "both selections" (inclusive combination of previous and new selection) or "overlapping set" (additional condition on the existing selection). Note that selection is possible both in the tour display and in the 1-d parameter display.

Below these options there are two small helper displays for the viewer:

- The axes display, visualising the currently shown projection.
- The coverage display, visualising the coverage in the space of all projections, and the current position along the trajectory of projections in the current tour path. This visualisation is based on a principal component analysis over all projection vectors occuring in the interpolated tour path and anchor points corresponding to bases aligned with the original parameter directions. The projection onto the first two principal components is shown, with anchor points shown in purple, the tour path basis vectors shown in green and the current position shown in black.

The middle column contains the main result, showing the projected data points in the form of a 2-d scatter plot. In addition we also show a projection of the hypercube containing all data points (if the data is not rescaled, the cube edge in each direction is shifted and connects the lowest value to the highest value). The display is made in plotly, in the "linked brushing" display, once the user selects points they will be highlighted in red, while the non-selected points will be made somewhat transparant to ensure view of the selected points without re-sorting. For other display selections (density or grouped) the default plotly behaviour is similar, highlighting the selected points while blending out the non-selected. Note however that in this case the brushing is not linked with the 1-d display.

Below the main result we show the timeline of the tour path. Points in red indicate anchor points selected by the tour path generator, all other planes result from the interpolation between those planes. The black point shows the position of the current plane in the timeline. When the tour is not playing we can click along the timeline to select a position in the path, this will update the display and the tour will be played from the selected point onwards. This is particularly useful in interaction with the print/save options or when going back to launch a local tour.

The final column contains the 1-d display of all parameter values (including those not selected for the tour display). This is most useful when working with the linked brushing option.


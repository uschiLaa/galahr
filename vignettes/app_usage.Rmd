---
title: "galahr: a GUI to assist learning about high dimensions in R"
author: "Ursula Laa"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using the GUI}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

galahr provides a GUI to the `tourr` package based on `shiny` and `plotly`. Upload your dataset and use the input panel to select settings for the tour and display, move to the results panel to play the tour animation.

## Basic usage

Launch the GUI with the default dataset as

```{r launchApp, eval = FALSE}
launchApp()
```


This will build a Shiny app with some initial default settings, the parameters can then be modified via the graphical interface inside the app. Note that the GUI has two separate tabs, "input"" and "results"", and the "Update results"" action button must be pressed before the results are updated with new input selections. This is because some options may result in long running times before the results can be updated (in particular recording a guided tour).

To look at a different dataset you can either use the file upload in the "input" panel after launching the app, or pass your dataframe in the function call. For example you can launch using the `GW170817` data as

```{r launchAppwData, eval = FALSE}
launchApp(paramDF = GW170817)
```

## Examples

### `tsfeatureData`
By default the `tsfeatureData` dataset is loaded when calling `launchApp()`. This data set contains features (calculated with the `tsfeatures` package) for three types of time series, the type is stored in the `category` variable. By default the app will start up with a grand tour shown in the density display, and up to six variables are selected. You can change the display type as follows

- go to the "input" panel
- in the second column select the "groups" display
- since there is only one categorical variable the grouping variable will be correctly preselected
- push the "update results" button to refresh the "results"
- move to the "results" panel and press "Play" to start the grand tour animation

### `galah`
Another example dataset included with this package is `galah`. Below we explain how to upload a planned tour path with this dataset

- we start by using the spinebil package to generate the planes between which we want to interpolate in the planned tour, you can do this as follows
 ```{r, eval = FALSE}
# matrix representation of planes to show in the planned tour
m1 <- spinebil::basisMatrix(1,2,6)
m2 <- spinebil::basisMatrix(3,4,6)
m3 <- spinebil::basisMatrix(5,6,6)
# store the planes in list format and save as .rds
galahPath <- list(m3, m1, m2, m3)
saveRDS(galahPath, file="galahPath.rds")
  )
  ```
- now lauch the app with the `galah` dataset
 ```{r, eval = FALSE}
 launchApp(galah)
 ```
- select the "groups" display as in the previous example (note that here the categorical variable contains hex codes which are directly mapped to color in the "results" display)
- select the tour type to be "Planned tour"
- this will enable a file upload for the tour path, upload the previously saved "galahPath.rds"
- update the results by pressing "update results"
- move to the "results" panel and hit "Play" to view the planned tour of the dataset

### `GW170817`

The third dataset included with the package is a posterior sample fitting neutron star parameters to the observed gravitational wave event GW170817.
FIXME paper reference to LIGO here?

- start by loading the app with this dataset:
 ```{r, eval = FALSE}
 launchApp(GW170817)
 ```
- keep the "density" display option which is appropriate for viewing posterior samples
- move to the "results" panel and try different values of "alpha" to tune the transparancy of the sample points
- look at the grand tour of this dataset - do you notice strong association between the parameters?
- move back to the "input" panel to change some of the setting
- try removing m2 from the list of parameters and selecting the tour type "Guided tour"
- you can now choose a projection pursuit index, if you have `mbgraphic` installed, try the "splines2d" index
- press "update results", this will now take about a minute to optimise the index and generate the guided tour path
- move back to the "results" panel to view the animation, moving towards a view showing strong functional dependence
- once you reached the final projection move back to the "input" panel
- select the "Local tour" option to explore the neighborhood of the current projection
- select the display type "linked brushing" and press "update results"
- move back to the "results" panel to play the local tour
- try selecting different regions on the 1-d parameter displays on the right with different options of "Update with selection as"

## The `input` panel

FIXME show screenshot of input panel?

The following options are available:

- File upload options to load parameter values from a CSV format data file
- Checkbox selection of the parameter values that should be used as input to the tour (choose from all numeric parameters in the input data)
- Checkbox selection to turn rescaling on/off. If on the data will be rescaled such that each parameter takes values between 0 and 1.
- Tour type selection. By default a short grand tour path will be generated. The other available options are: guided tour, planned tour, little tour and local tour (starting from the current basis, this is particularly useful when stopping the tour display and loading a local tour to explore the surroundings of an identified interesting view).
- If the selected tour type is grand, little or local tour the user may select the number of planes to generate (note that all tour paths are first recorded and then replayed in the results panel).
- If the selected tour type is guided tour the user may select the index function to be used. The options depend on the availability of relevant packages. The `tourr` functions `holes` and `cmass` are always available. If the `binostics` package is installed the scagnostics indexes "Skinny", "Striated", "Convex" and "Clumpy" are available. If the `mbgraphic` package is installed the index functions "splines2d" and "dcor2d" are available, and if the `minerva` package is installed the index functions "MIC" and "TIC" are available. In addition, if grouping is selected "lda_pp" and "pda_pp" from the `tourr` package are also available.
- If the selected tour type is planned tour, the user is asked to upload the anchor planes in RDS format.
- The angular step size used in the interpolation between planes can be selected between 0.01 and 1, with the default value at 0.05.
- The update results button must be pressed to load the tour path with the selected settings.
- There are currently three different display options. All displays are in the form of 2-d scatter plots, with selection between density display (allowing the user to tune the transparancy), linked brushing (with highlighting based on selection in either the 2-d projection or along input parameter values) and grouped display (mapping a selected grouping variable to color)
- If the grouped display is selected, the user may select a grouping variable from all character type input parameters.

## The `results` panel

The first column in the output panel contains several options for the user to select:

- A play button allowing to start/pause the tour.
- A save button that will save the current projection (FORMAT?).
- A print button that will print the current projection to the console.
- A save all button that will save the complete current tour path (i.e. all anchor planes, FORMAT?)
- If the selected display type is "density"" the user can select the point transparancy by choosing alpha between 0.01 and 1.
- If the selected display type is "linked brushing" the user can select the checkbox "Show selected points only" to remove all other points from the display (e.g. for more efficient rendering).
- There is also the option to select a sample from the input data, which will be randomly selected. This may be required for large datasize if rendering becomes to slow for viewing the tour display.
- In case of the "linked brushing" display the user may select the update logic between "new only" (reset selection each time), "both selections" (inclusive combination of previous and new selection) or "overlapping set" (additional condition on the existing selection). Note that selection is possible both in the tour display and in the 1-d parameter display.

Below these options there are two small helper displays for the viewer:

- The axes display, visualising the currently shown projection.
- The coverage display, visualising the coverage in the space of all projections, and the current position along the trajectory of projections in the current tour path. This visualisation is based on a principal component analysis over all projection vectors occuring in the interpolated tour path and anchor points corresponding to bases aligned with the original parameter directions. The projection onto the first two principal components is shown, with anchor points shown in purple, the tour path basis vectors shown in green and the current position shown in black.

The middle column contains the main result, showing the projected data points in the form of a 2-d scatter plot. In addition we also show a projection of the hypercube containing all data points (if the data is not rescaled, the cube edge in each direction is shifted and connects the lowest value to the highest value). The display is made in plotly, in the "linked brushing" display, once the user selects points they will be highlighted in red, while the non-selected points will be made somewhat transparant to ensure view of the selected points without re-sorting. For other display selections (density or grouped) the default plotly behaviour is similar, highlighting the selected points while blending out the non-selected. Note however that in this case the brushing is not linked with the 1-d display.

Below the main result we show the timeline of the tour path. Points in red indicate anchor points selected by the tour path generator, all other planes result from the interpolation between those planes. The black point shows the position of the current plane in the timeline. When the tour is not playing we can click along the timeline to select a position in the path, this will update the display and the tour will be played from the selected point onwards. This is particularly useful in interaction with the print/save options or when going back to launch a local tour.

The final column contains the 1-d display of all parameter values (including those not selected for the tour display). This is most useful when working with the linked brushing option.

